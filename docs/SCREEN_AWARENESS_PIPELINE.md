# Screen Awareness Pipeline Design

**Last Updated:** 2026-02-21  
**Status:** Design Complete  
**Target Platform:** Client Devices (Laptop, Desktop, Phone) + RPi5 Host

---

## 1. Overview & Philosophy

The Screen Awareness Pipeline enables the AI companion to understand what the user is seeing on their screen, providing contextual assistance based on visual content. This is a **privacy-sensitive, on-demand system** that respects user boundaries while enabling powerful screen-aware features.

### Design Principles

1. **Privacy First:** User has complete control over what is captured and when
2. **On-Demand:** Capture only when explicitly needed (user asks or goal requires)
3. **Client-Side Processing:** Heavy processing happens on client device to reduce host load
4. **Intelligent Redaction:** Automatically detect and blur sensitive information
5. **Selective Capture:** Support full screen, active window, regions, or smart areas
6. **Minimal Overhead:** Lightweight when idle, efficient when active

### Key Features

- **On-demand capture:** No continuous monitoring, only when user asks
- **Flexible capture modes:** Full screen, active window, regions, smart areas (notifications, active app)
- **Advanced understanding:** Object detection, OCR, activity recognition, UI element detection, accessibility tree analysis
- **Maximum privacy:** App blacklist + window title blacklist + intelligent redaction
- **Client-side processing:** Visual analysis happens on user's device, only insights sent to host
- **Cross-platform:** Support for Linux (X11/Wayland), macOS, Windows

---

## 2. Architecture Overview

### 2.1 System Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Screen Awareness Pipeline                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  CLIENT DEVICE (Laptop, Desktop, Phone)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚           Screen Capture Module                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - X11/Wayland API (Linux)                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Screen Capture API (macOS)                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Windows Graphics Capture API                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Modes: Full screen / Active window / Region / Smart     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                      â”‚ Raw pixels                               â”‚ â”‚
â”‚  â”‚                      â–¼                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚        Privacy Filter (Pre-Processing)                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Check app blacklist                                    â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Check window title blacklist                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Detect sensitive UI (password fields, credit cards)   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Apply redaction (blur regions)                         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                      â”‚ Redacted image                           â”‚ â”‚
â”‚  â”‚                      â–¼                                           â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚      Visual Processing Pipeline (CLIENT-SIDE)             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Stage 1: Basic Extraction                                â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   OCR       â”‚  â”‚Object Detect â”‚  â”‚ UI Element Det  â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ (Tesseract) â”‚  â”‚  (YOLO-Nano) â”‚  â”‚ (DOM/A11y tree) â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Stage 2: Context Understanding                           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚  Activity   â”‚  â”‚ App Context  â”‚  â”‚ Scene Class     â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ Recognition â”‚  â”‚  Detection   â”‚  â”‚                 â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Output: Structured insights (JSON)                       â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                      â”‚                                           â”‚ â”‚
â”‚  â”‚                      â”‚ Send to host (insights only, not pixels) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚ mTLS                                        â”‚
â”‚                         â–¼                                             â”‚
â”‚  HOST DEVICE (RPi5)                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚         Visual Agent (Host-Side)                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Receives structured insights from client               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Integrates with memory (store screen events)           â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Feeds to Central Agent for reasoning                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Can request specific analysis from client if needed    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚         Central Agent                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - Uses visual insights to answer user questions          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - "What's on my screen?" â†’ Query visual agent            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - "Summarize this page" â†’ Request text from client       â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  KEY DESIGN CHOICE:                                                  â”‚
â”‚  Raw pixels NEVER leave client device                                â”‚
â”‚  Only structured insights (JSON) sent to host                        â”‚
â”‚  â†’ Preserves privacy, reduces bandwidth, minimizes host load         â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Capture Modes

### 3.1 Four Capture Modes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Screen Capture Modes                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  MODE 1: FULL SCREEN                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Captures entire display (all monitors if multi-monitor setup)  â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Use cases:                                                      â”‚ â”‚
â”‚  â”‚ â€¢ "What's on my screen?"                                        â”‚ â”‚
â”‚  â”‚ â€¢ "Take a screenshot"                                           â”‚ â”‚
â”‚  â”‚ â€¢ General screen analysis                                       â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Resolution: Native (e.g., 1920x1080)                            â”‚ â”‚
â”‚  â”‚ File size: ~500 KB (PNG, compressed)                            â”‚ â”‚
â”‚  â”‚ Processing time: ~300ms (client-side)                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  MODE 2: ACTIVE WINDOW                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Captures only the currently focused window                      â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Use cases:                                                      â”‚ â”‚
â”‚  â”‚ â€¢ "What's in this window?"                                      â”‚ â”‚
â”‚  â”‚ â€¢ "Summarize this document"                                     â”‚ â”‚
â”‚  â”‚ â€¢ "Read this email"                                             â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Resolution: Window dimensions (e.g., 1200x800)                  â”‚ â”‚
â”‚  â”‚ File size: ~300 KB                                              â”‚ â”‚
â”‚  â”‚ Processing time: ~200ms                                         â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Advantages:                                                     â”‚ â”‚
â”‚  â”‚ â€¢ Focused analysis (ignore background clutter)                  â”‚ â”‚
â”‚  â”‚ â€¢ Faster processing (smaller image)                             â”‚ â”‚
â”‚  â”‚ â€¢ Better privacy (doesn't capture other windows)                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  MODE 3: REGION                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Captures user-specified rectangular region                      â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Use cases:                                                      â”‚ â”‚
â”‚  â”‚ â€¢ "What does this error message say?" (user highlights area)   â”‚ â”‚
â”‚  â”‚ â€¢ "Read this table" (select table region)                       â”‚ â”‚
â”‚  â”‚ â€¢ "What's this icon?" (select small region)                     â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User interaction:                                               â”‚ â”‚
â”‚  â”‚ â€¢ Companion: "Which part of the screen?"                        â”‚ â”‚
â”‚  â”‚ â€¢ User drags rectangle to select region                         â”‚ â”‚
â”‚  â”‚ â€¢ Companion captures only that region                           â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Resolution: Variable (user-defined)                             â”‚ â”‚
â”‚  â”‚ File size: ~50-200 KB                                           â”‚ â”‚
â”‚  â”‚ Processing time: ~100ms (smallest)                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  MODE 4: SMART AREAS                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Automatically detects and captures important regions            â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Smart detection heuristics:                                     â”‚ â”‚
â”‚  â”‚ â€¢ Notifications (top-right on most OSes)                        â”‚ â”‚
â”‚  â”‚ â€¢ Active application window                                     â”‚ â”‚
â”‚  â”‚ â€¢ Dialogs/popups (z-index analysis)                             â”‚ â”‚
â”‚  â”‚ â€¢ Mouse cursor location + surrounding area                      â”‚ â”‚
â”‚  â”‚ â€¢ Recently changed areas (diff detection)                       â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Use cases:                                                      â”‚ â”‚
â”‚  â”‚ â€¢ "What just popped up?"                                        â”‚ â”‚
â”‚  â”‚ â€¢ "What notifications do I have?"                               â”‚ â”‚
â”‚  â”‚ â€¢ "What am I working on?" (detects active app + context)        â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Example: User asks "What just popped up?"                       â”‚ â”‚
â”‚  â”‚ â†’ System detects notification area changed                      â”‚ â”‚
â”‚  â”‚ â†’ Captures notification region only (300x100 pixels)            â”‚ â”‚
â”‚  â”‚ â†’ OCR + analysis: "New email from Sarah"                        â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Resolution: Multiple small regions                              â”‚ â”‚
â”‚  â”‚ File size: ~100-300 KB total                                    â”‚ â”‚
â”‚  â”‚ Processing time: ~150ms                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  MODE SELECTION LOGIC:                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User query: "What's on my screen?"                              â”‚ â”‚
â”‚  â”‚ â†’ Default: FULL SCREEN                                          â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User query: "What's in this window?"                            â”‚ â”‚
â”‚  â”‚ â†’ ACTIVE WINDOW                                                 â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User query: "Read this table" (+ highlights region)             â”‚ â”‚
â”‚  â”‚ â†’ REGION                                                        â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User query: "What notification just came?"                      â”‚ â”‚
â”‚  â”‚ â†’ SMART AREAS (notification region)                             â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User can also explicitly specify:                               â”‚ â”‚
â”‚  â”‚ "Capture active window only"                                    â”‚ â”‚
â”‚  â”‚ "Show me what's in the top-right corner"                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Privacy Protection (Maximum Privacy Mode)

### 4.1 Multi-Layer Privacy System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Privacy Protection Pipeline                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  LAYER 1: App-Based Blacklist                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Block screen capture if user is in sensitive apps               â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Default blacklisted apps:                                       â”‚ â”‚
â”‚  â”‚ â€¢ Banking apps (Chase, Bank of America, PayPal, etc.)          â”‚ â”‚
â”‚  â”‚ â€¢ Password managers (1Password, Bitwarden, KeePass)            â”‚ â”‚
â”‚  â”‚ â€¢ Cryptocurrency wallets                                        â”‚ â”‚
â”‚  â”‚ â€¢ Healthcare apps (HIPAA compliance)                            â”‚ â”‚
â”‚  â”‚ â€¢ Government portals (IRS, DMV)                                 â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Detection method:                                               â”‚ â”‚
â”‚  â”‚ â€¢ Linux: Check active window class (wmctrl, xdotool)            â”‚ â”‚
â”‚  â”‚ â€¢ macOS: Check NSRunningApplication                             â”‚ â”‚
â”‚  â”‚ â€¢ Windows: Check window process name                            â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Behavior when blacklisted app active:                           â”‚ â”‚
â”‚  â”‚ â€¢ Refuse capture entirely                                       â”‚ â”‚
â”‚  â”‚ â€¢ Log: "Screen capture blocked: Sensitive app active"           â”‚ â”‚
â”‚  â”‚ â€¢ Return: {'error': 'privacy_blocked', 'reason': 'blacklist'}  â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User configuration:                                             â”‚ â”‚
â”‚  â”‚ â€¢ Can add custom apps to blacklist                              â”‚ â”‚
â”‚  â”‚ â€¢ Can remove apps from blacklist (if really needed)             â”‚ â”‚
â”‚  â”‚ â€¢ Can whitelist specific companion use cases (e.g., "Allow      â”‚ â”‚
â”‚  â”‚   OCR in password manager to help me type passwords")           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                            â”‚
â”‚                          â”‚ App not blacklisted                        â”‚
â”‚                          â–¼                                            â”‚
â”‚  LAYER 2: Window Title Blacklist                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Block based on window title patterns                            â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Blacklisted patterns (regex):                                   â”‚ â”‚
â”‚  â”‚ â€¢ ".*[Pp]assword.*"  (any window with "password" in title)     â”‚ â”‚
â”‚  â”‚ â€¢ ".*[Ll]ogin.*"                                                â”‚ â”‚
â”‚  â”‚ â€¢ ".*[Ss]ign [Ii]n.*"                                           â”‚ â”‚
â”‚  â”‚ â€¢ ".*[Pp]rivate [Bb]rowsing.*"                                  â”‚ â”‚
â”‚  â”‚ â€¢ ".*Incognito.*"                                               â”‚ â”‚
â”‚  â”‚ â€¢ ".*Banking.*"                                                 â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Example:                                                        â”‚ â”‚
â”‚  â”‚ Window title: "Enter Password - Chrome"                         â”‚ â”‚
â”‚  â”‚ â†’ Matches ".*[Pp]assword.*"                                     â”‚ â”‚
â”‚  â”‚ â†’ Block capture                                                 â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ User configuration:                                             â”‚ â”‚
â”‚  â”‚ â€¢ Add custom title patterns                                     â”‚ â”‚
â”‚  â”‚ â€¢ Case-insensitive by default                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                          â”‚                                            â”‚
â”‚                          â”‚ Title not blacklisted                      â”‚
â”‚                          â–¼                                            â”‚
â”‚  LAYER 3: Intelligent Redaction (ML-Based)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Detect and redact sensitive content in captured image           â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Detection Models (lightweight, client-side):                    â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ 1. Password Field Detection                                     â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚    â”‚ Method: UI element detection + heuristics             â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Detect <input type="password"> (web)                â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Detect QLineEdit with EchoMode::Password (Qt apps)  â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Detect dots/asterisks patterns in UI                â”‚   â”‚ â”‚
â”‚  â”‚    â”‚                                                        â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Action: Blur rectangular region around password field â”‚   â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ 2. Credit Card Detection                                        â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚    â”‚ Method: OCR + regex pattern matching                  â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Pattern: \d{4}[\s-]?\d{4}[\s-]?\d{4}[\s-]?\d{4}      â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ (Visa, Mastercard, Amex formats)                      â”‚   â”‚ â”‚
â”‚  â”‚    â”‚                                                        â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Action: Blur bounding box around detected card number â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Replace digits with "â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ"            â”‚   â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ 3. SSN/Personal ID Detection                                    â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚    â”‚ Method: OCR + pattern matching                        â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Patterns:                                              â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ SSN: \d{3}-\d{2}-\d{4}                              â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Driver's license: varies by state                   â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Passport: [A-Z]\d{8}                                â”‚   â”‚ â”‚
â”‚  â”‚    â”‚                                                        â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Action: Blur + replace with "â–ˆâ–ˆâ–ˆ-â–ˆâ–ˆ-â–ˆâ–ˆâ–ˆâ–ˆ"            â”‚   â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ 4. API Keys / Tokens Detection                                  â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚    â”‚ Method: OCR + entropy analysis + pattern matching     â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Patterns:                                              â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ AWS: AKIA[0-9A-Z]{16}                               â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ GitHub: ghp_[a-zA-Z0-9]{36}                         â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Stripe: sk_live_[a-zA-Z0-9]{24}                     â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ High entropy strings (>4.0 bits/char)                â”‚   â”‚ â”‚
â”‚  â”‚    â”‚                                                        â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Action: Blur + replace with "[REDACTED API KEY]"      â”‚   â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ 5. Private Browsing Indicator                                   â”‚ â”‚
â”‚  â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚    â”‚ Detect browser private mode indicators                â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Chrome: Dark theme + "Incognito" icon               â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Firefox: Purple mask icon                           â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ â€¢ Safari: Dark toolbar                                â”‚   â”‚ â”‚
â”‚  â”‚    â”‚                                                        â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Action: Blur entire browser content area              â”‚   â”‚ â”‚
â”‚  â”‚    â”‚ Note: "User is in private browsing mode"              â”‚   â”‚ â”‚
â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Redaction Visualization:                                        â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚ â”‚
â”‚  â”‚ â”‚ Original Screenshot:                                    â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Email: john@example.com                          â”‚   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Password: [secretpass123]  â† Password field      â”‚   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Credit Card: 4532 1234 5678 9012                 â”‚   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚                                                         â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ After Redaction:                                        â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Email: john@example.com                          â”‚   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Password: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ]  â† Blurred          â”‚   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â”‚ Credit Card: â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ â–ˆâ–ˆâ–ˆâ–ˆ  â† Redacted    â”‚   â”‚    â”‚ â”‚
â”‚  â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Performance:                                                    â”‚ â”‚
â”‚  â”‚ â€¢ Redaction adds ~50-100ms to processing                        â”‚ â”‚
â”‚  â”‚ â€¢ Lightweight models (ONNX Runtime)                             â”‚ â”‚
â”‚  â”‚ â€¢ Runs entirely on client device                                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  LAYER 4: User Review (Before Sending)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Optional: Show user redacted screenshot before sending          â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Setting: "Always show me what's being captured"                 â”‚ â”‚
â”‚  â”‚ â€¢ Default: OFF (trusted mode, auto-send)                        â”‚ â”‚
â”‚  â”‚ â€¢ Paranoid mode: ON (user reviews every capture)                â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ UI:                                                             â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚ â”‚ ğŸ“¸ Screen Capture Preview                                  â”‚â”‚ â”‚
â”‚  â”‚ â”‚                                                             â”‚â”‚ â”‚
â”‚  â”‚ â”‚ [Redacted Screenshot Thumbnail]                             â”‚â”‚ â”‚
â”‚  â”‚ â”‚                                                             â”‚â”‚ â”‚
â”‚  â”‚ â”‚ Detected sensitive items:                                   â”‚â”‚ â”‚
â”‚  â”‚ â”‚ â€¢ 1 password field (blurred)                                â”‚â”‚ â”‚
â”‚  â”‚ â”‚ â€¢ 1 credit card number (redacted)                           â”‚â”‚ â”‚
â”‚  â”‚ â”‚                                                             â”‚â”‚ â”‚
â”‚  â”‚ â”‚ Send this to companion for analysis?                        â”‚â”‚ â”‚
â”‚  â”‚ â”‚ [Send] [Cancel] [Adjust Redactions]                        â”‚â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  AUDIT LOGGING:                                                      â”‚
â”‚  All captures logged with:                                           â”‚
â”‚  â€¢ Timestamp                                                         â”‚
â”‚  â€¢ Capture mode (full/window/region/smart)                           â”‚
â”‚  â€¢ App context (if not blacklisted)                                  â”‚
â”‚  â€¢ Redactions applied (count, types)                                 â”‚
â”‚  â€¢ User approved (yes/no)                                            â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Privacy Configuration (User Settings)

```yaml
# privacy_config.yaml - User-editable privacy settings

privacy:
  # App blacklist (never capture these apps)
  blacklisted_apps:
    - "1Password"
    - "Bitwarden"
    - "KeePassXC"
    - "Chase"
    - "PayPal"
    - "Venmo"
    # User can add more...
  
  # Window title patterns to block
  blacklisted_window_patterns:
    - ".*[Pp]assword.*"
    - ".*[Ll]ogin.*"
    - ".*[Ss]ign [Ii]n.*"
    - ".*[Pp]rivate.*"
    - ".*Incognito.*"
  
  # Intelligent redaction settings
  redaction:
    enabled: true
    detect_passwords: true
    detect_credit_cards: true
    detect_ssn: true
    detect_api_keys: true
    detect_private_browsing: true
    blur_intensity: 20  # Gaussian blur radius
  
  # User review settings
  review_before_send: false  # Set to true for paranoid mode
  show_redaction_summary: true
  
  # Audit logging
  log_all_captures: true
  log_retention_days: 30
  
  # Emergency privacy mode
  # If enabled, ALL captures are blocked (e.g., during sensitive work)
  emergency_privacy_mode: false
```

---

## 5. Client-Side Visual Processing

### 5.1 Processing Pipeline (On Client Device)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Client-Side Visual Processing Pipeline                     â”‚
â”‚                  (All runs on user's device)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  Input: Redacted screenshot (PNG, ~500 KB)                           â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ STAGE 1: Basic Extraction (Parallel Processing)                â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚     OCR      â”‚  â”‚ Object Detectionâ”‚  â”‚ UI Element Det   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚              â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Tesseract    â”‚  â”‚  YOLO-Nano      â”‚  â”‚ DOM/A11y Tree    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ v5           â”‚  â”‚  (25 MB model)  â”‚  â”‚                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚              â”‚  â”‚                 â”‚  â”‚                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Extracts:    â”‚  â”‚ Detects:        â”‚  â”‚ Extracts:        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Text       â”‚  â”‚ â€¢ Buttons       â”‚  â”‚ â€¢ Input fields   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Bounding   â”‚  â”‚ â€¢ Icons         â”‚  â”‚ â€¢ Links          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   boxes      â”‚  â”‚ â€¢ Images        â”‚  â”‚ â€¢ Headings       â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Confidence â”‚  â”‚ â€¢ Text blocks   â”‚  â”‚ â€¢ Structure      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚              â”‚  â”‚ â€¢ UI elements   â”‚  â”‚                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ 100-200ms    â”‚  â”‚ 150-250ms       â”‚  â”‚ 50-100ms         â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚         â”‚                   â”‚                     â”‚            â”‚ â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚ â”‚
â”‚  â”‚                             â–¼                                   â”‚ â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚ â”‚
â”‚  â”‚            â”‚  Structured Data (JSON)         â”‚                 â”‚ â”‚
â”‚  â”‚            â”‚                                  â”‚                 â”‚ â”‚
â”‚  â”‚            â”‚  {                               â”‚                 â”‚ â”‚
â”‚  â”‚            â”‚    "text_blocks": [...],         â”‚                 â”‚ â”‚
â”‚  â”‚            â”‚    "objects": [...],             â”‚                 â”‚ â”‚
â”‚  â”‚            â”‚    "ui_elements": [...]          â”‚                 â”‚ â”‚
â”‚  â”‚            â”‚  }                               â”‚                 â”‚ â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ STAGE 2: Context Understanding                                  â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚   Activity       â”‚  â”‚  App Context    â”‚  â”‚Scene Class   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Recognition     â”‚  â”‚   Detection     â”‚  â”‚              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Classify user    â”‚  â”‚ Identify active â”‚  â”‚ Classify     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ activity:        â”‚  â”‚ application:    â”‚  â”‚ scene type:  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Reading        â”‚  â”‚ â€¢ Browser       â”‚  â”‚ â€¢ Document   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Writing        â”‚  â”‚ â€¢ Email client  â”‚  â”‚ â€¢ Code       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Coding         â”‚  â”‚ â€¢ IDE           â”‚  â”‚ â€¢ Email      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Video call     â”‚  â”‚ â€¢ Video conf    â”‚  â”‚ â€¢ Dashboard  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â€¢ Gaming         â”‚  â”‚ â€¢ Game          â”‚  â”‚ â€¢ Terminal   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                  â”‚  â”‚                 â”‚  â”‚              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ Small CNN        â”‚  â”‚ Process name +  â”‚  â”‚ ViT-tiny     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ (10 MB)          â”‚  â”‚ window title    â”‚  â”‚ (20 MB)      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ 50-100ms         â”‚  â”‚ <10ms           â”‚  â”‚ 50-100ms     â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚           â”‚                     â”‚                   â”‚         â”‚ â”‚
â”‚  â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â”‚                                 â–¼                              â”‚ â”‚
â”‚  â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚ â”‚
â”‚  â”‚            â”‚  Enriched Context (JSON)        â”‚                â”‚ â”‚
â”‚  â”‚            â”‚                                  â”‚                â”‚ â”‚
â”‚  â”‚            â”‚  {                               â”‚                â”‚ â”‚
â”‚  â”‚            â”‚    "activity": "reading",        â”‚                â”‚ â”‚
â”‚  â”‚            â”‚    "app": "firefox",             â”‚                â”‚ â”‚
â”‚  â”‚            â”‚    "scene": "document",          â”‚                â”‚ â”‚
â”‚  â”‚            â”‚    "confidence": 0.92            â”‚                â”‚ â”‚
â”‚  â”‚            â”‚  }                               â”‚                â”‚ â”‚
â”‚  â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ STAGE 3: Semantic Understanding (Optional, Heavy)              â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  Only if requested or needed for specific queries:             â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Visual Question Answering (VQA)                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Model: CLIP-ViT-B/32 (150 MB, quantized to INT8)         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Capability: Answer questions about image content         â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Example:                                                  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   Q: "How many unread emails?"                            â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   â†’ Encode image + question â†’ similarity score           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚   A: "5 unread emails"                                    â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Latency: ~500ms (only when needed)                        â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ Image Captioning                                          â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Model: BLIP-Base (100 MB, quantized)                     â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Generates: Natural language description of screen        â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Example: "A web browser showing an email inbox with      â”‚  â”‚ â”‚
â”‚  â”‚  â”‚           several unread messages and a compose button"   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Latency: ~400ms (only when needed)                        â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ OUTPUT: Structured Visual Insights (JSON)                      â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ {                                                               â”‚ â”‚
â”‚  â”‚   "timestamp": "2026-02-21T03:00:00Z",                         â”‚ â”‚
â”‚  â”‚   "capture_mode": "active_window",                             â”‚ â”‚
â”‚  â”‚   "app_context": {                                             â”‚ â”‚
â”‚  â”‚     "app_name": "firefox",                                     â”‚ â”‚
â”‚  â”‚     "window_title": "Gmail - Inbox",                           â”‚ â”‚
â”‚  â”‚     "process_id": 12345                                        â”‚ â”‚
â”‚  â”‚   },                                                            â”‚ â”‚
â”‚  â”‚   "activity": "reading",                                       â”‚ â”‚
â”‚  â”‚   "scene_type": "email",                                       â”‚ â”‚
â”‚  â”‚   "text_content": {                                            â”‚ â”‚
â”‚  â”‚     "blocks": [                                                â”‚ â”‚
â”‚  â”‚       {"text": "Inbox (5)", "bbox": [10, 50, 100, 70]},      â”‚ â”‚
â”‚  â”‚       {"text": "Meeting reminder", "bbox": [120, 100, ...]},  â”‚ â”‚
â”‚  â”‚       ...                                                       â”‚ â”‚
â”‚  â”‚     ],                                                          â”‚ â”‚
â”‚  â”‚     "full_text": "Inbox (5)\nMeeting reminder\n..."           â”‚ â”‚
â”‚  â”‚   },                                                            â”‚ â”‚
â”‚  â”‚   "objects": [                                                 â”‚ â”‚
â”‚  â”‚     {"type": "button", "label": "Compose", "bbox": [...]},    â”‚ â”‚
â”‚  â”‚     {"type": "icon", "label": "inbox", "bbox": [...]},        â”‚ â”‚
â”‚  â”‚     ...                                                         â”‚ â”‚
â”‚  â”‚   ],                                                            â”‚ â”‚
â”‚  â”‚   "ui_elements": {                                             â”‚ â”‚
â”‚  â”‚     "inputs": [],                                              â”‚ â”‚
â”‚  â”‚     "buttons": [{"text": "Compose", "bbox": [...]}],          â”‚ â”‚
â”‚  â”‚     "links": [{"text": "Meeting reminder", "url": "..."}]     â”‚ â”‚
â”‚  â”‚   },                                                            â”‚ â”‚
â”‚  â”‚   "insights": {                                                â”‚ â”‚
â”‚  â”‚     "unread_count": 5,                                         â”‚ â”‚
â”‚  â”‚     "primary_action": "compose",                               â”‚ â”‚
â”‚  â”‚     "notable_items": ["Meeting reminder from John"]           â”‚ â”‚
â”‚  â”‚   },                                                            â”‚ â”‚
â”‚  â”‚   "privacy": {                                                 â”‚ â”‚
â”‚  â”‚     "redactions_applied": 2,                                   â”‚ â”‚
â”‚  â”‚     "sensitive_types": ["password_field", "credit_card"]      â”‚ â”‚
â”‚  â”‚   },                                                            â”‚ â”‚
â”‚  â”‚   "caption": "Gmail inbox with 5 unread emails" // Optional   â”‚ â”‚
â”‚  â”‚ }                                                               â”‚ â”‚
â”‚  â”‚                                                                 â”‚ â”‚
â”‚  â”‚ Size: ~10-50 KB (structured JSON, no raw pixels)               â”‚ â”‚
â”‚  â”‚ Processing time: ~300-500ms total                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                 â”‚                                    â”‚
â”‚                                 â”‚ Send to host via mTLS              â”‚
â”‚                                 â–¼                                    â”‚
â”‚                         RPi5 (Host Device)                           â”‚
â”‚                  Visual Agent receives JSON insights                 â”‚
â”‚                   (Never sees raw screenshot pixels)                 â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Model Selection (Lightweight, Client-Optimized)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Client-Side Model Specifications                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚  OCR: Tesseract 5 (Open Source)                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Size: ~30 MB (eng + fast config)                                â”‚ â”‚
â”‚  â”‚ Latency: 100-200ms for full screen                              â”‚ â”‚
â”‚  â”‚ Accuracy: 95%+ on clean text                                    â”‚ â”‚
â”‚  â”‚ Pros: Well-tested, handles multiple languages                   â”‚ â”‚
â”‚  â”‚ Cons: Struggles with handwriting, low-contrast text             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Object Detection: YOLO-Nano (Ultralytics)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Size: 25 MB (ONNX, INT8 quantized)                              â”‚ â”‚
â”‚  â”‚ Latency: 150-250ms for 1920x1080                                â”‚ â”‚
â”‚  â”‚ Classes: Custom trained on UI elements                          â”‚ â”‚
â”‚  â”‚   - Buttons, icons, text blocks, images, videos, inputs        â”‚ â”‚
â”‚  â”‚ Accuracy: 85%+ on UI elements                                   â”‚ â”‚
â”‚  â”‚ Pros: Fast, lightweight, works offline                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Activity Recognition: MobileNetV3-Small (Custom Trained)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Size: 10 MB (TFLite, INT8)                                      â”‚ â”‚
â”‚  â”‚ Latency: 50-100ms                                               â”‚ â”‚
â”‚  â”‚ Classes: 10 activities (reading, writing, coding, video call,  â”‚ â”‚
â”‚  â”‚          browsing, gaming, idle, presentation, chat, media)     â”‚ â”‚
â”‚  â”‚ Accuracy: 90%+ on clear activities                              â”‚ â”‚
â”‚  â”‚ Training: Trained on 50k labeled screenshots                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Scene Classification: ViT-Tiny (Vision Transformer)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Size: 20 MB (ONNX, FP16)                                        â”‚ â”‚
â”‚  â”‚ Latency: 50-100ms                                               â”‚ â”‚
â”‚  â”‚ Classes: 15 scene types (document, code, email, dashboard,     â”‚ â”‚
â”‚  â”‚          terminal, social media, video, image, spreadsheet,     â”‚ â”‚
â”‚  â”‚          presentation, chat, file manager, settings, browser)   â”‚ â”‚
â”‚  â”‚ Accuracy: 92%+ on common scenes                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  VQA (Optional): CLIP-ViT-B/32 (OpenAI)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Size: 150 MB (ONNX, INT8 quantized)                             â”‚ â”‚
â”‚  â”‚ Latency: ~500ms                                                 â”‚ â”‚
â”‚  â”‚ Use case: Answer specific questions about screen content        â”‚ â”‚
â”‚  â”‚ Only loaded when needed (not part of default pipeline)          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Image Captioning (Optional): BLIP-Base                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Size: 100 MB (ONNX, FP16)                                       â”‚ â”‚
â”‚  â”‚ Latency: ~400ms                                                 â”‚ â”‚
â”‚  â”‚ Use case: Generate natural language description                 â”‚ â”‚
â”‚  â”‚ Only loaded when needed                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                       â”‚
â”‚  Total Baseline Models (Always Loaded): ~85 MB                      â”‚
â”‚  Total with Optional Models: ~335 MB                                 â”‚
â”‚                                                                       â”‚
â”‚  Model Loading Strategy:                                             â”‚
â”‚  â€¢ Baseline models: Loaded on client agent startup                  â”‚
â”‚  â€¢ Optional models: Lazy-loaded when specific queries require them  â”‚ â”‚
â”‚  â€¢ All models cached after first load                                â”‚
â”‚  â€¢ Models run via ONNX Runtime (cross-platform)                     â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Host-Side Integration (Visual Agent on RPi5)

### 6.1 Visual Agent (Receives Insights from Client)

```python
# visual_agent.py - Host-side visual agent

import asyncio
import json
from typing import Dict, Any, Optional

class VisualAgent:
    """
    Visual Agent on host (RPi5) that receives structured insights
    from client devices.
    
    NOTE: This agent NEVER receives raw screenshots. Only JSON insights.
    """
    
    def __init__(
        self,
        memory_mgr: 'MemoryManager',
        client_comm: 'ClientCommunicator'
    ):
        self.memory_mgr = memory_mgr
        self.client_comm = client_comm
        self.current_screen_context = None
    
    async def process_screen_query(self, query: str, user_id: str) -> Dict[str, Any]:
        """
        Process a screen-related query from the user.
        
        Examples:
        - "What's on my screen?"
        - "How many unread emails do I have?"
        - "Read the error message"
        """
        # Step 1: Determine capture mode from query
        capture_mode = self._determine_capture_mode(query)
        
        # Step 2: Request capture from client
        insights = await self._request_screen_capture(
            user_id=user_id,
            mode=capture_mode,
            query=query
        )
        
        if 'error' in insights:
            return {'error': insights['error'], 'reason': insights.get('reason')}
        
        # Step 3: Store in memory (structured insights, not pixels)
        await self._store_screen_event(insights)
        
        # Step 4: Generate response based on query
        response = await self._generate_response(query, insights)
        
        return response
    
    def _determine_capture_mode(self, query: str) -> str:
        """Determine appropriate capture mode from query."""
        query_lower = query.lower()
        
        if 'window' in query_lower or 'this' in query_lower:
            return 'active_window'
        elif 'notification' in query_lower or 'popup' in query_lower:
            return 'smart_areas'
        elif 'region' in query_lower or 'area' in query_lower:
            return 'region'  # Will prompt user to select
        else:
            return 'full_screen'  # Default
    
    async def _request_screen_capture(
        self,
        user_id: str,
        mode: str,
        query: Optional[str] = None
    ) -> Dict[str, Any]:
        """
        Request screen capture from client device.
        
        Returns: Structured JSON insights (no raw pixels).
        """
        # Send capture request to client
        request = {
            'type': 'screen_capture_request',
            'mode': mode,
            'query': query,  # Optional: helps client optimize processing
            'timestamp': datetime.utcnow().isoformat()
        }
        
        # Wait for client response (with timeout)
        try:
            insights = await self.client_comm.request(
                user_id=user_id,
                request=request,
                timeout=10.0  # 10 second timeout
            )
            
            return insights
        
        except asyncio.TimeoutError:
            return {'error': 'Client did not respond in time'}
        except Exception as e:
            return {'error': f'Failed to capture screen: {str(e)}'}
    
    async def _store_screen_event(self, insights: Dict[str, Any]):
        """Store screen capture insights in memory."""
        memory_entry = {
            'type': 'screen_event',
            'timestamp': insights['timestamp'],
            'app_context': insights.get('app_context', {}),
            'activity': insights.get('activity'),
            'scene_type': insights.get('scene_type'),
            'text_summary': insights['text_content']['full_text'][:500],  # First 500 chars
            'notable_items': insights['insights'].get('notable_items', []),
            'importance': self._calculate_importance(insights),
        }
        
        await self.memory_mgr.store(memory_entry)
    
    def _calculate_importance(self, insights: Dict[str, Any]) -> float:
        """Calculate importance score for screen event."""
        importance = 0.3  # Base importance
        
        # Boost for specific apps
        app_name = insights.get('app_context', {}).get('app_name', '')
        if app_name in ['email', 'calendar', 'slack']:
            importance += 0.2
        
        # Boost for certain activities
        activity = insights.get('activity', '')
        if activity in ['reading', 'writing', 'coding']:
            importance += 0.1
        
        # Boost if notable items detected
        if insights['insights'].get('notable_items'):
            importance += 0.2
        
        return min(importance, 1.0)
    
    async def _generate_response(
        self,
        query: str,
        insights: Dict[str, Any]
    ) -> Dict[str, Any]:
        """Generate natural language response to screen query."""
        query_lower = query.lower()
        
        # Specific query handlers
        if 'how many' in query_lower and 'email' in query_lower:
            unread_count = insights['insights'].get('unread_count', 0)
            return {
                'answer': f"You have {unread_count} unread emails.",
                'details': insights['insights'].get('notable_items', [])
            }
        
        elif 'what' in query_lower and ('screen' in query_lower or 'see' in query_lower):
            # General screen description
            app = insights['app_context']['app_name']
            scene = insights['scene_type']
            activity = insights['activity']
            
            caption = insights.get('caption', '')
            if caption:
                response = caption
            else:
                response = (
                    f"You're {activity} in {app}. "
                    f"It looks like a {scene} view."
                )
            
            # Add notable items if any
            notable = insights['insights'].get('notable_items', [])
            if notable:
                response += f" Notable items: {', '.join(notable[:3])}."
            
            return {'answer': response, 'full_context': insights}
        
        elif 'read' in query_lower:
            # Extract all text
            text = insights['text_content']['full_text']
            return {
                'answer': text,
                'text_blocks': insights['text_content']['blocks']
            }
        
        else:
            # Fallback: provide general insights
            return {
                'answer': f"I can see you're in {insights['app_context']['app_name']}.",
                'insights': insights['insights'],
                'text_preview': insights['text_content']['full_text'][:200]
            }
    
    async def get_current_screen_context(self, user_id: str) -> Optional[Dict[str, Any]]:
        """
        Get current screen context without explicit user query.
        Used by Central Agent for proactive awareness.
        """
        # Check if we have recent screen context in memory
        recent_screen = await self.memory_mgr.retrieve(
            query={'type': 'screen_event'},
            limit=1,
            max_age_seconds=30
        )
        
        if recent_screen:
            return recent_screen[0]
        
        # No recent context, optionally request new capture
        # (only if user has enabled proactive awareness)
        return None
```

---

## 7. Cross-Platform Implementation

### 7.1 Screen Capture APIs (By Platform)

```python
# screen_capture.py - Cross-platform screen capture

import platform
from abc import ABC, abstractmethod
from typing import Tuple, Optional
import numpy as np

class ScreenCapturer(ABC):
    """Abstract base class for screen capture."""
    
    @abstractmethod
    def capture_full_screen(self) -> np.ndarray:
        """Capture entire screen. Returns: numpy array (H, W, 3)."""
        pass
    
    @abstractmethod
    def capture_active_window(self) -> np.ndarray:
        """Capture active window. Returns: numpy array (H, W, 3)."""
        pass
    
    @abstractmethod
    def capture_region(self, x: int, y: int, w: int, h: int) -> np.ndarray:
        """Capture specific region. Returns: numpy array (H, W, 3)."""
        pass
    
    @abstractmethod
    def get_active_window_info(self) -> dict:
        """Get info about active window (title, app name, process)."""
        pass


class LinuxScreenCapturer(ScreenCapturer):
    """Screen capturer for Linux (X11/Wayland)."""
    
    def __init__(self):
        self.display_server = self._detect_display_server()
        
        if self.display_server == 'X11':
            from Xlib import display, X
            from PIL import ImageGrab
            self.display = display.Display()
        elif self.display_server == 'Wayland':
            # Use grim for Wayland
            import subprocess
            self.subprocess = subprocess
    
    def _detect_display_server(self) -> str:
        """Detect if running X11 or Wayland."""
        import os
        if os.environ.get('WAYLAND_DISPLAY'):
            return 'Wayland'
        return 'X11'
    
    def capture_full_screen(self) -> np.ndarray:
        """Capture full screen on Linux."""
        if self.display_server == 'X11':
            # Use PIL ImageGrab (X11)
            from PIL import ImageGrab
            img = ImageGrab.grab()
            return np.array(img)
        
        else:  # Wayland
            # Use grim (Wayland screenshot tool)
            import tempfile
            with tempfile.NamedTemporaryFile(suffix='.png') as tmp:
                self.subprocess.run(['grim', tmp.name], check=True)
                from PIL import Image
                img = Image.open(tmp.name)
                return np.array(img)
    
    def capture_active_window(self) -> np.ndarray:
        """Capture active window on Linux."""
        if self.display_server == 'X11':
            # Get active window ID
            import subprocess
            result = subprocess.run(
                ['xdotool', 'getactivewindow'],
                capture_output=True,
                text=True,
                check=True
            )
            window_id = result.stdout.strip()
            
            # Capture window using import tool
            import tempfile
            with tempfile.NamedTemporaryFile(suffix='.png') as tmp:
                subprocess.run(
                    ['import', '-window', window_id, tmp.name],
                    check=True
                )
                from PIL import Image
                img = Image.open(tmp.name)
                return np.array(img)
        
        else:  # Wayland
            # Use grim with slurp for active window
            import tempfile
            with tempfile.NamedTemporaryFile(suffix='.png') as tmp:
                # Get focused window geometry
                geom = subprocess.run(
                    ['swaymsg', '-t', 'get_tree'],
                    capture_output=True,
                    text=True
                ).stdout
                # Parse and capture (simplified)
                subprocess.run(['grim', '-g', geom, tmp.name], check=True)
                from PIL import Image
                img = Image.open(tmp.name)
                return np.array(img)
    
    def capture_region(self, x: int, y: int, w: int, h: int) -> np.ndarray:
        """Capture specific region on Linux."""
        if self.display_server == 'X11':
            from PIL import ImageGrab
            img = ImageGrab.grab(bbox=(x, y, x+w, y+h))
            return np.array(img)
        else:  # Wayland
            import tempfile
            with tempfile.NamedTemporaryFile(suffix='.png') as tmp:
                geom = f"{x},{y} {w}x{h}"
                self.subprocess.run(['grim', '-g', geom, tmp.name], check=True)
                from PIL import Image
                img = Image.open(tmp.name)
                return np.array(img)
    
    def get_active_window_info(self) -> dict:
        """Get active window info on Linux."""
        import subprocess
        
        if self.display_server == 'X11':
            # Get window ID
            window_id = subprocess.run(
                ['xdotool', 'getactivewindow'],
                capture_output=True,
                text=True
            ).stdout.strip()
            
            # Get window name
            window_name = subprocess.run(
                ['xdotool', 'getwindowname', window_id],
                capture_output=True,
                text=True
            ).stdout.strip()
            
            # Get process ID
            pid = subprocess.run(
                ['xdotool', 'getwindowpid', window_id],
                capture_output=True,
                text=True
            ).stdout.strip()
            
            # Get process name
            process_name = subprocess.run(
                ['ps', '-p', pid, '-o', 'comm='],
                capture_output=True,
                text=True
            ).stdout.strip()
            
            return {
                'window_id': window_id,
                'window_title': window_name,
                'process_id': int(pid),
                'app_name': process_name
            }
        
        else:  # Wayland (swaymsg)
            import json
            tree = subprocess.run(
                ['swaymsg', '-t', 'get_tree'],
                capture_output=True,
                text=True
            ).stdout
            tree_json = json.loads(tree)
            
            # Find focused window (recursive search)
            focused = self._find_focused_window(tree_json)
            
            return {
                'window_title': focused.get('name', ''),
                'app_name': focused.get('app_id', ''),
                'process_id': focused.get('pid', 0)
            }
    
    def _find_focused_window(self, node: dict) -> dict:
        """Recursively find focused window in Sway tree."""
        if node.get('focused'):
            return node
        for child in node.get('nodes', []) + node.get('floating_nodes', []):
            result = self._find_focused_window(child)
            if result:
                return result
        return {}


class MacOSScreenCapturer(ScreenCapturer):
    """Screen capturer for macOS."""
    
    def capture_full_screen(self) -> np.ndarray:
        """Capture full screen on macOS."""
        import Quartz
        from PIL import Image
        
        # Get main display
        region = Quartz.CGRectInfinite
        image = Quartz.CGWindowListCreateImage(
            region,
            Quartz.kCGWindowListOptionOnScreenOnly,
            Quartz.kCGNullWindowID,
            Quartz.kCGWindowImageDefault
        )
        
        # Convert to numpy array
        width = Quartz.CGImageGetWidth(image)
        height = Quartz.CGImageGetHeight(image)
        bytesperrow = Quartz.CGImageGetBytesPerRow(image)
        pixeldata = Quartz.CGDataProviderCopyData(
            Quartz.CGImageGetDataProvider(image)
        )
        
        img = Image.frombytes('RGB', (width, height), pixeldata, 
                               'raw', 'BGRX', bytesperrow, 1)
        return np.array(img)
    
    def capture_active_window(self) -> np.ndarray:
        """Capture active window on macOS."""
        from AppKit import NSWorkspace
        from Quartz import CGWindowListCopyWindowInfo, kCGWindowListOptionOnScreenOnly
        
        # Get active app
        active_app = NSWorkspace.sharedWorkspace().activeApplication()
        app_name = active_app['NSApplicationName']
        
        # Get window list
        windows = CGWindowListCopyWindowInfo(
            kCGWindowListOptionOnScreenOnly,
            0
        )
        
        # Find active window
        for window in windows:
            if window.get('kCGWindowOwnerName') == app_name:
                bounds = window['kCGWindowBounds']
                return self.capture_region(
                    int(bounds['X']),
                    int(bounds['Y']),
                    int(bounds['Width']),
                    int(bounds['Height'])
                )
        
        # Fallback to full screen
        return self.capture_full_screen()
    
    def capture_region(self, x: int, y: int, w: int, h: int) -> np.ndarray:
        """Capture region on macOS."""
        import Quartz
        from PIL import Image
        
        region = Quartz.CGRectMake(x, y, w, h)
        image = Quartz.CGWindowListCreateImage(
            region,
            Quartz.kCGWindowListOptionOnScreenOnly,
            Quartz.kCGNullWindowID,
            Quartz.kCGWindowImageDefault
        )
        
        # Convert to numpy
        width = Quartz.CGImageGetWidth(image)
        height = Quartz.CGImageGetHeight(image)
        bytesperrow = Quartz.CGImageGetBytesPerRow(image)
        pixeldata = Quartz.CGDataProviderCopyData(
            Quartz.CGImageGetDataProvider(image)
        )
        
        img = Image.frombytes('RGB', (width, height), pixeldata,
                               'raw', 'BGRX', bytesperrow, 1)
        return np.array(img)
    
    def get_active_window_info(self) -> dict:
        """Get active window info on macOS."""
        from AppKit import NSWorkspace
        from Quartz import CGWindowListCopyWindowInfo, kCGWindowListOptionOnScreenOnly
        
        active_app = NSWorkspace.sharedWorkspace().activeApplication()
        
        return {
            'app_name': active_app['NSApplicationName'],
            'process_id': active_app['NSApplicationProcessIdentifier'],
            'window_title': ''  # macOS doesn't easily expose window titles
        }


class WindowsScreenCapturer(ScreenCapturer):
    """Screen capturer for Windows."""
    
    def capture_full_screen(self) -> np.ndarray:
        """Capture full screen on Windows."""
        from PIL import ImageGrab
        img = ImageGrab.grab()
        return np.array(img)
    
    def capture_active_window(self) -> np.ndarray:
        """Capture active window on Windows."""
        import win32gui
        import win32ui
        import win32con
        from PIL import Image
        
        # Get active window handle
        hwnd = win32gui.GetForegroundWindow()
        
        # Get window rect
        left, top, right, bottom = win32gui.GetWindowRect(hwnd)
        width = right - left
        height = bottom - top
        
        # Create device context
        hwndDC = win32gui.GetWindowDC(hwnd)
        mfcDC = win32ui.CreateDCFromHandle(hwndDC)
        saveDC = mfcDC.CreateCompatibleDC()
        
        # Create bitmap
        saveBitMap = win32ui.CreateBitmap()
        saveBitMap.CreateCompatibleBitmap(mfcDC, width, height)
        saveDC.SelectObject(saveBitMap)
        
        # Copy window content
        saveDC.BitBlt((0, 0), (width, height), mfcDC, (0, 0), win32con.SRCCOPY)
        
        # Convert to PIL Image
        bmpinfo = saveBitMap.GetInfo()
        bmpstr = saveBitMap.GetBitmapBits(True)
        img = Image.frombuffer(
            'RGB',
            (bmpinfo['bmWidth'], bmpinfo['bmHeight']),
            bmpstr, 'raw', 'BGRX', 0, 1
        )
        
        # Cleanup
        win32gui.DeleteObject(saveBitMap.GetHandle())
        saveDC.DeleteDC()
        mfcDC.DeleteDC()
        win32gui.ReleaseDC(hwnd, hwndDC)
        
        return np.array(img)
    
    def capture_region(self, x: int, y: int, w: int, h: int) -> np.ndarray:
        """Capture region on Windows."""
        from PIL import ImageGrab
        img = ImageGrab.grab(bbox=(x, y, x+w, y+h))
        return np.array(img)
    
    def get_active_window_info(self) -> dict:
        """Get active window info on Windows."""
        import win32gui
        import win32process
        import psutil
        
        hwnd = win32gui.GetForegroundWindow()
        window_title = win32gui.GetWindowText(hwnd)
        
        _, process_id = win32process.GetWindowThreadProcessId(hwnd)
        process = psutil.Process(process_id)
        
        return {
            'window_title': window_title,
            'process_id': process_id,
            'app_name': process.name()
        }


def get_screen_capturer() -> ScreenCapturer:
    """Factory function to get appropriate screen capturer for platform."""
    system = platform.system()
    
    if system == 'Linux':
        return LinuxScreenCapturer()
    elif system == 'Darwin':
        return MacOSScreenCapturer()
    elif system == 'Windows':
        return WindowsScreenCapturer()
    else:
        raise NotImplementedError(f"Screen capture not supported on {system}")
```

---

## 8. Resource Estimates

### Client Device

**Memory (During Active Capture):**
- Screen capture: 50 MB (temporary buffer)
- OCR (Tesseract): 30 MB
- Object detection (YOLO-Nano): 25 MB
- Activity recognition: 10 MB
- Scene classification: 20 MB
- Processing overhead: 50 MB
- **Total: ~185 MB**

**Idle (Models Loaded, Not Processing):**
- ~100 MB

**Storage:**
- Models: 85 MB (baseline), 335 MB (with optional)
- Client agent: 20 MB
- Dependencies: 100 MB
- **Total: ~200-450 MB**

**CPU (During Processing):**
- ~60-80% for 300-500ms
- Idle: <5%

**Bandwidth (Per Capture):**
- Insights JSON: ~10-50 KB (compressed)
- No raw pixels sent!

### Host Device (RPi5)

**Memory:**
- Visual Agent: 50 MB
- **Total: ~50 MB** (minimal, just receives JSON)

**CPU:**
- Processing insights: <5%

**Storage:**
- Visual agent code: 5 MB
- Stored insights in memory system: ~50 MB/month

---

## 9. Summary & Next Steps

### Design Complete âœ…

**Screen Awareness Pipeline includes:**
1. âœ… On-demand capture (no continuous monitoring)
2. âœ… Four capture modes (full/window/region/smart)
3. âœ… Advanced understanding (OCR, object detection, UI elements, activity recognition, scene classification, accessibility tree)
4. âœ… Maximum privacy (app blacklist + title blacklist + intelligent redaction + user review)
5. âœ… Client-side processing (raw pixels never leave device)
6. âœ… Cross-platform support (Linux X11/Wayland, macOS, Windows)
7. âœ… Lightweight models (~85 MB baseline, ~335 MB with optional)

### Key Privacy Features

- **Zero continuous monitoring:** Only captures on explicit user request
- **Four-layer privacy:** App blacklist â†’ title blacklist â†’ intelligent redaction â†’ user review
- **Client-side only:** Raw screenshots never sent to host, only structured JSON insights
- **Audit trail:** All captures logged

### Integration Points

**With Central Agent:**
- Visual insights feed into decision loop
- Answers screen-related queries

**With Memory Consolidation:**
- Screen events stored as structured memories

**With Module Activation:**
- Visual Agent loaded on-demand when user asks about screen

**With Tool Plugin System:**
- Screen capture is a capability tools can request (with permission)

---

**Design Status:** âœ… COMPLETE  
**Ready for:** Implementation Phase 1  
**Estimated Implementation Time:** 3-4 weeks
